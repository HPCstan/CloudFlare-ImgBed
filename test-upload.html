<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImgBed ä¸Šå‚³æ¸¬è©¦å·¥å…·</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f14;
            --bg-card: #1a1a24;
            --bg-input: #22222e;
            --border: #2d2d3d;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.25);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --success: #22c55e;
            --success-bg: rgba(34, 197, 94, 0.1);
            --error: #ef4444;
            --error-bg: rgba(239, 68, 68, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 2rem;
        }

        /* è¨­å®šå€å¡Š */
        .config-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .config-section h2 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .config-grid .full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        input,
        select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* ä¸Šå‚³å€åŸŸ */
        .upload-zone {
            background: var(--bg-card);
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-zone .icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
        }

        .upload-zone p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .upload-zone .hint {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .upload-btns {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            font-family: inherit;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* æª”æ¡ˆåˆ—è¡¨ */
        .file-list {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .file-list-header h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.825rem;
        }

        .file-item:last-child {
            margin-bottom: 0;
        }

        .file-item .name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 0.75rem;
        }

        .file-item .size {
            color: var(--text-muted);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .file-item .remove-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0 0.25rem;
            margin-left: 0.5rem;
            font-size: 1rem;
        }

        .file-item .remove-btn:hover {
            color: var(--error);
        }

        /* é€²åº¦æ¢ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--bg-input);
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-hover));
            border-radius: 2px;
            transition: width 0.3s;
            width: 0%;
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
        }

        /* çµæœå€åŸŸ */
        .results {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .results h2 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .result-item {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-item.success {
            border-left: 3px solid var(--success);
        }

        .result-item.error {
            border-left: 3px solid var(--error);
        }

        .result-filename {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .result-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            white-space: nowrap;
            min-width: 80px;
        }

        .result-value {
            flex: 1;
            font-size: 0.8rem;
            font-family: 'Consolas', 'Monaco', monospace;
            background: var(--bg-primary);
            padding: 0.35rem 0.6rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            overflow-x: auto;
            white-space: nowrap;
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: var(--accent-hover);
        }

        .copy-btn.copied {
            background: var(--success);
        }

        .result-preview {
            margin-top: 0.75rem;
            border-radius: 8px;
            overflow: hidden;
            max-height: 200px;
        }

        .result-preview img {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            display: block;
        }

        .error-msg {
            color: var(--error);
            font-size: 0.8rem;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 600px) {
            .config-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“¤ ImgBed ä¸Šå‚³æ¸¬è©¦å·¥å…·</h1>
        <p class="subtitle">ä¸Šå‚³æª”æ¡ˆåˆ°ä½ çš„ CloudFlare ImgBed ä¸¦ç²å–é€£çµ</p>

        <!-- è¨­å®š -->
        <div class="config-section">
            <h2>âš™ï¸ é€£ç·šè¨­å®š</h2>
            <div class="config-grid">
                <div class="full-width">
                    <label>ImgBed ç¶²å€</label>
                    <input type="text" id="apiUrl" value="https://imgbed.ajwkptc.uk"
                        placeholder="https://your-imgbed.example.com">
                </div>
                <div class="full-width">
                    <label>API Token æˆ– èªè­‰ç¢¼ï¼ˆauthCodeï¼‰</label>
                    <input type="password" id="apiToken" placeholder="è¼¸å…¥ä½ çš„ API Token æˆ– authCode">
                </div>
                <div>
                    <label>ä¸Šå‚³æ¸ é“</label>
                    <select id="uploadChannel">
                        <option value="telegram">Telegram</option>
                        <option value="cfr2">Cloudflare R2</option>
                        <option value="s3">S3</option>
                    </select>
                </div>
                <div>
                    <label>å‘½åæ–¹å¼</label>
                    <select id="uploadNameType">
                        <option value="default">é è¨­ï¼ˆå‰ç¶´_åŸåï¼‰</option>
                        <option value="index">åƒ…å‰ç¶´</option>
                        <option value="origin">åƒ…åŸå</option>
                        <option value="short">çŸ­é€£çµ</option>
                    </select>
                </div>
                <div>
                    <label>ä¸Šå‚³ç›®éŒ„ï¼ˆé¸å¡«ï¼‰</label>
                    <input type="text" id="uploadFolder" placeholder="ä¾‹å¦‚ï¼šblog/images">
                </div>
                <div>
                    <label>è¿”å›æ ¼å¼</label>
                    <select id="returnFormat">
                        <option value="full">å®Œæ•´ URL</option>
                        <option value="default">ç›¸å°è·¯å¾‘</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ä¸Šå‚³å€åŸŸ -->
        <div class="upload-zone" id="dropZone">
            <div class="icon">ğŸ“</div>
            <p>æ‹–æ›³æª”æ¡ˆåˆ°æ­¤è™•ï¼Œæˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡</p>
            <p class="hint">æ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€æ–‡ä»¶ç­‰å„ç¨®æ ¼å¼</p>
            <div class="upload-btns">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">é¸æ“‡æª”æ¡ˆ</button>
                <button class="btn btn-secondary"
                    onclick="document.getElementById('folderInput').click()">é¸æ“‡è³‡æ–™å¤¾</button>
            </div>
            <input type="file" id="fileInput" multiple style="display:none">
            <input type="file" id="folderInput" webkitdirectory directory style="display:none">
        </div>

        <!-- å·²é¸æª”æ¡ˆåˆ—è¡¨ -->
        <div class="file-list hidden" id="fileList">
            <div class="file-list-header">
                <h3>ğŸ“‹ å·²é¸æª”æ¡ˆ (<span id="fileCount">0</span>)</h3>
                <div>
                    <button class="btn btn-secondary" onclick="clearFiles()" style="margin-right:0.5rem;">æ¸…é™¤</button>
                    <button class="btn btn-primary" id="uploadBtn" onclick="startUpload()">ğŸš€ é–‹å§‹ä¸Šå‚³</button>
                </div>
            </div>
            <div id="fileItems"></div>
        </div>

        <!-- é€²åº¦ -->
        <div class="hidden" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">ä¸Šå‚³ä¸­...</p>
        </div>

        <!-- çµæœ -->
        <div class="results hidden" id="resultsSection">
            <h2>âœ… ä¸Šå‚³çµæœ</h2>
            <div id="resultItems"></div>
        </div>
    </div>

    <script>
        let selectedFiles = [];

        // NOTE: æ‹–æ”¾èˆ‡æª”æ¡ˆé¸æ“‡äº‹ä»¶ç¶å®š
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            addFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', () => {
            addFiles(fileInput.files);
            fileInput.value = '';
        });
        folderInput.addEventListener('change', () => {
            addFiles(folderInput.files);
            folderInput.value = '';
        });

        /**
         * å°‡é¸å–çš„æª”æ¡ˆåŠ å…¥å¾…ä¸Šå‚³åˆ—è¡¨
         * @param {FileList} files - ä½¿ç”¨è€…é¸å–çš„æª”æ¡ˆ
         */
        function addFiles(files) {
            for (const file of files) {
                // NOTE: é¿å…é‡è¤‡æ·»åŠ ç›¸åŒæª”æ¡ˆï¼ˆç”¨åç¨± + å¤§å°åˆ¤æ–·ï¼‰
                const exists = selectedFiles.some(f => f.name === file.name && f.size === file.size);
                if (!exists) {
                    selectedFiles.push(file);
                }
            }
            renderFileList();
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderFileList();
        }

        function clearFiles() {
            selectedFiles = [];
            renderFileList();
        }

        /**
         * æ ¼å¼åŒ–æª”æ¡ˆå¤§å°ç‚ºäººé¡å¯è®€å­—ä¸²
         */
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1024 / 1024).toFixed(2) + ' MB';
        }

        function renderFileList() {
            const listEl = document.getElementById('fileList');
            const itemsEl = document.getElementById('fileItems');
            const countEl = document.getElementById('fileCount');

            if (selectedFiles.length === 0) {
                listEl.classList.add('hidden');
                return;
            }

            listEl.classList.remove('hidden');
            countEl.textContent = selectedFiles.length;

            itemsEl.innerHTML = selectedFiles.map((file, i) => `
                <div class="file-item">
                    <span class="name" title="${file.name}">${file.name}</span>
                    <span class="size">${formatSize(file.size)}</span>
                    <button class="remove-btn" onclick="removeFile(${i})">&times;</button>
                </div>
            `).join('');
        }

        /**
         * é–‹å§‹æ‰¹é‡ä¸Šå‚³æ‰€æœ‰å·²é¸æª”æ¡ˆ
         */
        async function startUpload() {
            if (selectedFiles.length === 0) return;

            const apiUrl = document.getElementById('apiUrl').value.replace(/\/$/, '');
            const apiToken = document.getElementById('apiToken').value;
            const uploadChannel = document.getElementById('uploadChannel').value;
            const uploadNameType = document.getElementById('uploadNameType').value;
            const uploadFolder = document.getElementById('uploadFolder').value;
            const returnFormat = document.getElementById('returnFormat').value;

            if (!apiUrl) {
                alert('è«‹å¡«å¯« ImgBed ç¶²å€ï¼');
                return;
            }

            // é¡¯ç¤ºé€²åº¦
            const progressSection = document.getElementById('progressSection');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const resultsSection = document.getElementById('resultsSection');
            const resultItems = document.getElementById('resultItems');
            const uploadBtn = document.getElementById('uploadBtn');

            progressSection.classList.remove('hidden');
            resultsSection.classList.remove('hidden');
            resultItems.innerHTML = '';
            uploadBtn.disabled = true;

            let completed = 0;
            const total = selectedFiles.length;

            for (const file of selectedFiles) {
                progressText.textContent = `ä¸Šå‚³ä¸­ (${completed + 1}/${total})ï¼š${file.name}`;
                progressFill.style.width = `${(completed / total) * 100}%`;

                try {
                    const result = await uploadFile(file, apiUrl, apiToken, {
                        uploadChannel, uploadNameType, uploadFolder, returnFormat
                    });
                    renderResult(resultItems, file.name, result, apiUrl);
                } catch (err) {
                    renderError(resultItems, file.name, err.message);
                }

                completed++;
                progressFill.style.width = `${(completed / total) * 100}%`;
            }

            progressText.textContent = `å…¨éƒ¨å®Œæˆï¼å…± ${total} å€‹æª”æ¡ˆ`;
            uploadBtn.disabled = false;
        }

        /**
         * ä¸Šå‚³å–®ä¸€æª”æ¡ˆåˆ° ImgBed API
         * @param {File} file - è¦ä¸Šå‚³çš„æª”æ¡ˆ
         * @param {string} apiUrl - ImgBed ç¶²å€
         * @param {string} token - API Token
         * @param {Object} options - ä¸Šå‚³é¸é …
         * @returns {Object} API å›æ‡‰çµæœ
         */
        async function uploadFile(file, apiUrl, token, options) {
            const formData = new FormData();
            formData.append('file', file);

            // NOTE: ä½¿ç”¨ query åƒæ•¸å‚³éä¸Šå‚³è¨­å®š
            const params = new URLSearchParams();
            if (options.uploadChannel) params.set('uploadChannel', options.uploadChannel);
            if (options.uploadNameType) params.set('uploadNameType', options.uploadNameType);
            if (options.uploadFolder) params.set('uploadFolder', options.uploadFolder);
            if (options.returnFormat) params.set('returnFormat', options.returnFormat);

            // NOTE: ä½¿ç”¨ Authorization header ç™¼é€ API Token
            const headers = {};
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const url = `${apiUrl}/upload?${params.toString()}`;
            const response = await fetch(url, {
                method: 'POST',
                headers,
                body: formData
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }

            return await response.json();
        }

        /**
         * æ¸²æŸ“ä¸Šå‚³æˆåŠŸçš„çµæœé …ç›®
         */
        function renderResult(container, filename, result, apiUrl) {
            const src = result[0]?.src || '';
            // NOTE: å¦‚æœå›å‚³çš„æ˜¯ç›¸å°è·¯å¾‘ï¼Œæ‹¼æ¥å®Œæ•´ URL
            const fullUrl = src.startsWith('http') ? src : `${apiUrl}${src}`;
            const htmlCode = `<img src="${fullUrl}" alt="${filename}">`;
            const markdownCode = `![${filename}](${fullUrl})`;
            const isImage = /\.(png|jpg|jpeg|gif|webp|svg)$/i.test(filename);

            const div = document.createElement('div');
            div.className = 'result-item success';
            div.innerHTML = `
                <div class="result-filename">âœ… ${filename}</div>
                <div class="result-row">
                    <span class="result-label">ğŸ”— ä¸‹è¼‰é€£çµ</span>
                    <span class="result-value">${fullUrl}</span>
                    <button class="copy-btn" onclick="copyText(this, '${fullUrl.replace(/'/g, "\\'")}')">è¤‡è£½</button>
                </div>
                <div class="result-row">
                    <span class="result-label">ğŸŒ HTML ç¢¼</span>
                    <span class="result-value">${escapeHtml(htmlCode)}</span>
                    <button class="copy-btn" onclick="copyText(this, '${htmlCode.replace(/'/g, "\\'")}')">è¤‡è£½</button>
                </div>
                <div class="result-row">
                    <span class="result-label">ğŸ“ Markdown</span>
                    <span class="result-value">${escapeHtml(markdownCode)}</span>
                    <button class="copy-btn" onclick="copyText(this, '${markdownCode.replace(/'/g, "\\'")}')">è¤‡è£½</button>
                </div>
                ${isImage ? `
                <div class="result-preview">
                    <img src="${fullUrl}" alt="${filename}" loading="lazy">
                </div>
                ` : ''}
            `;
            container.appendChild(div);
        }

        function renderError(container, filename, errorMsg) {
            const div = document.createElement('div');
            div.className = 'result-item error';
            div.innerHTML = `
                <div class="result-filename">âŒ ${filename}</div>
                <p class="error-msg">${escapeHtml(errorMsg)}</p>
            `;
            container.appendChild(div);
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        /**
         * è¤‡è£½æ–‡å­—åˆ°å‰ªè²¼ç°¿ï¼Œä¸¦åˆ‡æ›æŒ‰éˆ•ç‹€æ…‹
         */
        async function copyText(btn, text) {
            try {
                await navigator.clipboard.writeText(text);
                btn.textContent = 'å·²è¤‡è£½';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'è¤‡è£½';
                    btn.classList.remove('copied');
                }, 1500);
            } catch {
                // HACK: éƒ¨åˆ†ç€è¦½å™¨ä¸æ”¯æŒ clipboard APIï¼Œä½¿ç”¨ fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                btn.textContent = 'å·²è¤‡è£½';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'è¤‡è£½';
                    btn.classList.remove('copied');
                }, 1500);
            }
        }
    </script>
</body>

</html>